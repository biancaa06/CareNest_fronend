stages:
 - build
 - test
 - docker_deployment

build:
 stage: build
 image: node:20-alpine
 script:
 - npm install
 - npm run build

 e2e-tests:
  stage: test
  image: cypress/included:12.16.0
  dependencies:
    - build
  variables:
    CYPRESS_BASE_URL: "http://localhost:5173"
  script:
    - npm install
    - npx cypress run
  only:
    - main

build-docker-image:
 stage: docker_deployment
 script:
 - docker stop carenest-frontend; if ($?) { docker rm carenest-frontend }
 - docker build -t carenest-fe:dev .
 - docker run --name carenest-frontend -p 5173:5173 -d carenest-fe:dev
 only:
    - main